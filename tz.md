# Техническое задание: Smart Commit Tool

## 1. Обзор проекта

### 1.1 Название
Smart Commit Tool - глобальный инструмент для генерации осмысленных сообщений коммитов с использованием ИИ

### 1.2 Цель
Создать npm-пакет для глобальной установки, который позволяет автоматически генерировать качественные сообщения коммитов на основе анализа изменений в коде с помощью GPT моделей.

### 1.3 Проблема
Разработчики часто пишут некачественные или бессмысленные сообщения коммитов. Текущие скрипты `smart_commit.cjs` и `gpt-commit-helper.cjs` приходится копировать в каждый проект, что неудобно для поддержки и обновлений.

## 2. Функциональные требования

### 2.1 Основные функции

#### 2.1.1 Анализ изменений
- Автоматическое определение git-репозитория в текущей директории
- Получение списка измененных файлов (`git diff --name-only --cached`)
- Получение diff изменений (`git diff --cached`)
- Анализ типов изменений (frontend, backend, docs, config, assets и т.д.)

#### 2.1.2 Генерация контента с помощью GPT
- Генерация сообщения коммита в conventional commits формате
- Генерация названия версии релиза
- Генерация описания релиза с разделами (новые функции, исправления, улучшения)
- Поддержка различных моделей GPT (gpt-5-nano, gpt-4o-mini, claude-3.5-haiku и др.)

#### 2.1.3 Управление коммитами
- Автоматическое добавление файлов (`git add .`)
- Создание коммита с сгенерированным сообщением
- Отправка на удаленный репозиторий (`git push`)
- Поддержка dry-run режима для тестирования

### 2.2 Режимы работы

#### 2.2.1 Стандартный режим
```bash
smart-commit
```
- Автоматически анализирует изменения
- Генерирует сообщение через GPT
- Создает и отправляет коммит

#### 2.2.2 Dry-run режим
```bash
smart-commit --dry-run
```
- Показывает, какое сообщение будет сгенерировано
- Не создает коммит

#### 2.2.3 Режим только генерации
```bash
smart-commit --generate-only
```
- Только генерирует сообщение, не создает коммит

#### 2.2.4 Пользовательское сообщение
```bash
smart-commit --message "feat: add new feature"
```
- Использует указанное сообщение вместо генерации

### 2.3 Конфигурация

#### 2.3.1 Глобальная конфигурация
- Выбор модели GPT по умолчанию
- Настройка API ключей
- Настройка лимитов токенов
- Настройка температуры генерации

#### 2.3.2 Локальная конфигурация проекта
- `.smart-commit.json` в корне проекта для переопределения настроек
- Игнорирование определенных файлов/папок
- Кастомные правила для типов изменений

## 3. Технические требования

### 3.1 Стек технологий
- **Язык**: Node.js (ES6+)
- **Пакетный менеджер**: npm
- **API**: GPT API через gptunnel.ru или альтернативные провайдеры
- **Git интеграция**: node child_process для выполнения git команд
- **Конфигурация**: JSON файлы

### 3.2 Зависимости
- `axios` - для HTTP запросов к GPT API
- `commander` - для парсинга аргументов командной строки
- `fs-extra` - для работы с файлами
- `chalk` - для цветного вывода в консоль
- `ora` - для спиннеров загрузки

### 3.3 Системные требования
- Node.js >= 16.0.0
- npm >= 7.0.0
- Git >= 2.0.0
- Доступ к интернету (для GPT API)

### 3.4 Производительность
- Время генерации: < 30 секунд для типичного коммита
- Размер анализируемого diff: до 100k символов
- Поддержка репозиториев с 1000+ файлами

## 4. Архитектура

### 4.1 Структура пакета
```
smart-commit/
├── bin/
│   └── smart-commit.js          # Исполняемый файл
├── lib/
│   ├── index.js                 # Главный модуль
│   ├── git-analyzer.js          # Анализ git изменений
│   ├── gpt-helper.js            # Работа с GPT API
│   ├── commit-generator.js      # Генерация сообщений
│   └── config-manager.js        # Управление конфигурацией
├── config/
│   ├── default-config.json      # Конфигурация по умолчанию
│   └── models.json              # Доступные модели
├── templates/
│   └── commit-templates.json    # Шаблоны сообщений
├── package.json
├── README.md
└── LICENSE
```

### 4.2 Классы и модули

#### 4.2.1 SmartCommit (главный класс)
- Координация работы всех компонентов
- Обработка аргументов командной строки
- Управление жизненным циклом

#### 4.2.2 GitAnalyzer
- Анализ git статуса
- Получение diff и списка файлов
- Определение типов изменений

#### 4.2.3 GPTHelper
- Отправка запросов к GPT API
- Обработка ответов и ошибок
- Управление моделями и токенами

#### 4.2.4 CommitGenerator
- Генерация сообщений коммитов
- Генерация названий версий
- Генерация описаний релизов

#### 4.2.5 ConfigManager
- Загрузка и слияние конфигураций
- Валидация настроек
- Сохранение пользовательских настроек

## 5. Этапы разработки

### 5.1 Этап 1: Подготовка (1-2 дня)
- Создание структуры npm пакета
- Настройка package.json
- Перенос существующего кода
- Добавление commander для CLI

### 5.2 Этап 2: Рефакторинг (2-3 дня)
- Разделение на модули
- Создание классов GitAnalyzer, GPTHelper, etc.
- Добавление обработки ошибок
- Улучшение логирования

### 5.3 Этап 3: Конфигурация (1-2 дня)
- Реализация ConfigManager
- Поддержка .smart-commit.json
- Глобальная конфигурация пользователя
- Валидация настроек

### 5.4 Этап 4: CLI интерфейс (1-2 дня)
- Реализация различных режимов (--dry-run, --generate-only, etc.)
- Обработка аргументов
- Справка и --help
- Цветной вывод

### 5.5 Этап 5: Тестирование и доработка (2-3 дня)
- Unit тесты
- Integration тесты
- Тестирование на разных проектах
- Исправление багов

### 5.6 Этап 6: Документация и публикация (1-2 дня)
- README.md
- Примеры использования
- Публикация на npm
- CI/CD настройка

## 6. Тестирование

### 6.1 Unit тесты
- Тестирование отдельных модулей
- Mock для GPT API
- Тестирование парсинга git вывода

### 6.2 Integration тесты
- Тестирование полного цикла
- Тестирование различных сценариев
- Тестирование с реальными git репозиториями

### 6.3 Ручное тестирование
- Тестирование на реальных проектах разных типов
- Тестирование edge cases
- Тестирование производительности

## 7. Безопасность

### 7.1 API ключи
- Хранение API ключей в защищенном месте
- Не логировать ключи в выводе
- Валидация ключей перед использованием

### 7.2 Проверки
- Проверка наличия git репозитория
- Проверка наличия staged изменений
- Проверка доступа к удаленному репозиторию

## 8. Документация

### 8.1 README.md
- Установка и настройка
- Примеры использования
- Доступные команды и опции
- Конфигурация

### 8.2 Код
- JSDoc комментарии для всех функций
- Примеры использования в коде
- Описание конфигурационных файлов

## 9. Критерии приемки

### 9.1 Функциональные
- [ ] Глобальная установка через npm
- [ ] Автоматическое определение git репозитория
- [ ] Генерация сообщений через GPT
- [ ] Поддержка всех режимов работы
- [ ] Обработка ошибок

### 9.2 Технические
- [ ] Код покрыт тестами (>80%)
- [ ] Производительность в рамках требований
- [ ] Совместимость с Node.js >= 16
- [ ] Кроссплатформенность (Windows/Mac/Linux)

### 9.3 Качественные
- [ ] Понятная документация
- [ ] Удобный CLI интерфейс
- [ ] Обработка edge cases
- [ ] Локализация сообщений

## 10. Риски и ограничения

### 10.1 Риски
- Зависимость от внешнего GPT API
- Ограничения по токенам и стоимости
- Возможные изменения в GitHub API

### 10.2 Ограничения
- Требует интернет подключения
- Работает только с git
- Зависит от качества GPT моделей

## 11. План внедрения

### 11.1 Альфа версия
- Базовый функционал
- Ограниченный набор моделей
- Минимальная конфигурация

### 11.2 Бета версия
- Полный набор функций
- Расширенная конфигурация
- Улучшенная обработка ошибок

### 11.3 Стабильный релиз
- Полная документация
- Тестовое покрытие
- Публикация на npm

## 12. Метрики успеха

### 12.1 Технические метрики
- Время установки: < 5 минут
- Время первого коммита: < 30 секунд
- Успешность генерации: > 95%

### 12.2 Пользовательские метрики
- Удовлетворенность интерфейсом
- Частота использования
- Количество звезд на GitHub

### 12.3 Бизнес метрики
- Количество скачиваний пакета
- Стоимость использования GPT API
- Вовлеченность сообщества
